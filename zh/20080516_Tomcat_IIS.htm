<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>雪峰博客</title><meta name="description" content="分享AI和云计算技术的最新动态与实践经验，以及其它有趣的话题。"><meta name="keywords" content="AI, GitHub Copilot, Azure云, 云计算, 前端技术, 后端技术, Web开发, 软件工程"><link rel="stylesheet" href="/assets/css/style.min.css"><link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script></head><body><nav class="navbar"><div class="nav-container"><div class="nav-logo"><h2><i class="fas fa-snowflake"></i> Snowpeak</h2></div><div class="nav-menu"><a href="/" class="nav-link">首页</a><a href="/zh/page_1.htm" class="nav-link">文章</a><a href="/#tools" class="nav-link">工具</a><a href="/zh/about.htm" class="nav-link">关于</a><a href="/en/" class="nav-link lang-switch"><i class="fas fa-globe"></i> English</a></div><div class="nav-toggle" id="mobile-menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div></div></nav><header class="article-header"><div class="container"><h1>Tomcat 整合进 IIS</h1><div class="article-meta"><span><i class="fas fa-calendar"></i> 发布时间: 2008-05-16 17:35:00</span><span><i class="fas fa-clock"></i> 阅读约需: 7 分钟 </span><span><i class="fas fa-tag"></i> 分类: 软件工具</span></div></div></header><main class="article-container"><p>网上也有不少探讨，我结合各家介绍及查错，经过几天努力，也试通一种方案。我知道 Java 的东西鲜有“放之四海而皆准”的解决方案，分享在此，只为给大家提供多点思路。</p><h2>环境：</h2><ul><li>Windox XP SP2 下的 IIS5.1, Windows Server 2003 下的 IIS6.0</li><li>java version "1.6.0_03"</li><li>Java(TM) SE Runtime Environment (build 1.6.0_03-b05)</li><li>Apache Tomcat/5.5.25</li></ul><h2>简要步骤：</h2><p>IIS 和 Apache Tomcat 安装过程不再赘述，请自行测试保证IIS 和 Tomcat 已经正常运行，以下都建立在最常用的默认安装路径及设置基础之上，按惯例，我们用 <code>$CATALINA_HOME</code> 表示 Tomcat 安装路径。</p><p>设置 Windows 环境变量 :</p> <pre><code class="language-plaintext">JAVA_HOME=c:/j2sdk1.4.0
CLASSPATH=.;%JAVA_HOME%/lib;%JAVA_HOME%/jre/lib;
PATH=%JAVA_HOME%/bin;%JAVA_HOME%/jre/bin;
</code></pre> <ol><li><p>下载最新版的 <code>jakarta-tomcat-connectors</code><a href="http://archive.apache.org/dist/tomcat/tomcat-connectors/jk2/binaries/win32/?C=M;O=D/">http://archive.apache.org/dist/tomcat/tomcat-connectors/jk2/binaries/win32/?C=M;O=D/</a> 找形如 <code>jakarta-tomcat-connectors-jk2.0.4-win32-IIS.zip</code> 最新版的文件 解压出来 <code>isapi_redirector2.dll</code>，放到 <code>$CATALINA_HOME/bin</code> 文件夹下</p></li><li><p>把 <code>workers.properties</code> 和 <code>workers2.properties</code> 文件放到 <code>$CATALINA_HOME/conf</code> 文件夹下</p></li></ol><p>这里有我用的2个范例文件，请根据你的具体安装情况更改相应的路径设置</p><p><strong>workers.properties 文件</strong></p> <pre><code class="language-properties">workers.tomcat_home=C:/Server/Tomcat5.5

# workers.java_home should point to your Java installation. Normally
# you should have a bin and lib directories beneath it.
workers.java_home=C:/Program Files/Java/jre1.6.0_03

# You should configure your environment slash... ps=/ on NT and / on UNIX
# and maybe something different elsewhere.
ps=/

# The workers that your plugins should create and work with
worker.list=neosmart

#------ DEFAULT ajp13 WORKER DEFINITION ------------------------------
#---------------------------------------------------------------------
# Defining a worker named ajp13 and of type ajp13
# Note that the name and the type do not have to match.
worker.neosmart.port=8009
worker.neosmart.host=localhost
worker.neosmart.type=ajp13
</code></pre> <p><strong>workers2.properties 文件</strong></p> <pre><code class="language-properties">[shm]
info=Scoreboard. Requried for reconfiguration and status with multiprocess servers.
file=C:/Server/Tomcat5.5/work/workers.shm

# Defines a load balancer named lb. Use even if you only have one machine.
[lb:lb]

# Example socket channel, override port and host.
[channel.socket:localhost:8009]
port=8009
host=127.0.0.1

# define the worker
[ajp13:localhost:8009]
channel=channel.socket:localhost:8009
group=lb

# Map the Tomcat examples webapp to the Web server uri space
[uri:/examples/*]
group=lb

[status:]
info=Status worker, displays runtime information

[uri:/jkstatus/*]
info=The Tomcat /jkstatus handler
group=status:

# Map webapps to the Web server uri space
[uri:/*.jsp]
[uri:/*.do]
</code></pre> <ol><li>添加注册表 最简单的方法是把如下内容存成一个注册表文件，扩展名为 <code>.reg</code>，直接导入即可。</li></ol> <pre><code class="language-reg">Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE/SOFTWARE/Apache Software Foundation/Jakarta Isapi Redirector/2.0]
&quot;serverRoot&quot;=&quot;C://Server//Tomcat5.5//&quot;
&quot;extensionUri&quot;=&quot;/jakarta/isapi_redirector2.dll&quot;
&quot;workersFile&quot;=&quot;C://Server//Tomcat5.5//conf//workers2.properties&quot;
&quot;logLevel&quot;=&quot;INFO&quot;
</code></pre> <ol><li><p>IIS设置</p></li><li><p><strong>ISAPI 筛选器</strong> 在 IIS 中“网站”右键属性，进入 ISAPI 筛选器，点击 <strong>添加</strong> 按钮，键入一个新的筛选器名称，名称可以随意起，再点击浏览按钮，选择刚才放在 <code>$CATALINA_HOME/bin</code> 文件夹下的 <code>isapi_redirector2.dll</code>。新加完的筛选器状态会是未知，没关系，待会重启后就好了。</p></li><li><p><strong>虚拟路径</strong> 选择需要加载 Tomcat 服务站点，右键选择 <strong>新建 &gt; 虚拟目录</strong>，创建虚拟目录，别名为 <code>jakarta</code>。注意这个名字是固定值，不要拼写错误！ 指定目录为 <code>isapi_redirector2.dll</code> 所在目录，即 <code>$CATALINA_HOME/bin</code> 文件夹，在允许权限下要选中“执行”。</p></li><li><p><strong>添加映射文件</strong> IIS 中选中站点右键点击选择属性，依次“主目录”选项页点“配置”，在“映射”选项页点“添加”。 可执行文件选择 <code>isapi_redirector2.dll</code> 所在目录，扩展名为 <code>.jsp</code>；再加一个可执行文件相同，扩展名为 <code>.do</code>。</p></li><li><p><strong>IIS6.0 网络服务扩展</strong> 如果是 IIS6.0，还要再添加一个网络服务扩展。 扩展名用 <code>.jsp</code>，需要的文件选 <code>isapi_redirector2.dll</code>，然后设置为启用状态。</p></li><li><p>为合作工作设置相同的虚拟目录</p></li></ol><p><code>$CATALINA_HOME/conf</code> 中 <code>server.xml</code> 找到 <code>&lt;Host&gt;</code> 段，里面加一句：</p> <pre><code class="language-xml">&lt;Context path=&quot;/jsp-examples&quot; docBase=&quot;C:/Server/Tomcat5.5/webapps/jsp-examples&quot;&gt;&lt;/Context&gt;
</code></pre> <p>然后 IIS 中使用 JSP 的站点添加一个虚拟路径，名字和指向要和上面一致，即，路径名为 <code>jsp-examples</code>，也要指向 <code>C:/Server/Tomcat5.5/webapps/jsp-examples</code>。</p><ol><li>设置权限</li></ol><p>如果系统是 NTFS 区，要把以上 <code>isapi_redirector2.dll</code>、各个配置文件所在路径和要运行 JSP 的路径以及其中的文件都赋给 <code>IUSR_machinename</code>（<code>machinename</code> 是机器名，如我的机器名叫 <code>ads</code>，则这个用户就是 <code>IUSR_ads</code>）用户读和写的权限。</p><ol><li>重启 IIS 和 Tomcat</li></ol><p>到 ISAPI 筛选器查看，如果看到刚才新添加的 ISAPI 筛选器显示为绿色箭头，说明它已经被成功加载了。再到 <code>workers2.properties</code> 文件中 <code>[shm]</code> 段设置的文件路径查看，应该可以看到生成了那个文件，本例中是：</p> <pre><code class="language-plaintext">file=C:/Server/Tomcat5.5/work/workers.shm
</code></pre> <p>这时访问：</p><p><a href="http://localhost/jsp-examplest/">http://localhost/jsp-examplest/</a></p><p>若能看到结果，则成功完成，恭喜你！</p><h2>问题：</h2><ol><li>如果目录首页是 JSP 文件，有时 IIS 会不认，这没关系，可以通过 IIS 中已经设置的默认首页，如 <code>index.html</code> 页面跳转到首页 JSP 文件就，比如做个 <code>index.html</code>，代码用如下一行就够：</li></ol> <pre><code class="language-html">&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=index.jsp&quot;&gt;
</code></pre> <ol><li>我做的过程中主要遇到的是 NTFS 权限问题，常见到 IIS 报错：</li></ol> <pre><code>HTTP 401.3 - Access denied by ACL on resource
</code></pre> <p>Windows XP 对 NTFS 权限非常麻烦，最后试成的就是要给 <code>isapi_redirector2.dll</code>、各个配置文件所在路径和要运行 JSP 的路径以及其中的文件赋给 <code>IUSR_machinename</code>（<code>machinename</code> 是机器名，如我的机器名叫 <code>ads</code>，则这个用户就是 <code>IUSR_ads</code>）用户读和写的权限。</p><p>如果还不行，注意看 Tomcat 的日志和 Windows 事件查看，结合再查。</p><hr><p><em>原文链接: https://www.snowpeak.fun/cn/article/detail/integrate_tomcat_into_iis/</em></p></main><footer class="footer"><div class="container"><div class="footer-content"><div class="footer-section"><h3><i class="fas fa-snowflake"></i> Snowpeak</h3><p>分享AI和云计算技术的最新动态与实践经验，以及其它有趣的话题。</p><div class="social-links"><div class="social-platforms"><a href="https://github.com/xfsnow" target="_blank" class="social-link"><i class="fab fa-github"></i></a><a href="https://snowpeak.blog.csdn.net/" target="_blank" class="social-link"><i class="fas fa-blog"></i></a><a href="https://space.bilibili.com/701839928" target="_blank" class="social-link"><i class="fab fa-bilibili"></i></a><a href="https://www.linkedin.com/in/snowpeak" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a></div><div class="wechat-section"><div class="wechat-info"><span class="wechat-label">微信公众号</span><span class="wechat-name">技术温暖生活</span></div><img src="/assets/img/techwarm.jpg" alt="技术温暖生活" class="wechat-qr"></div></div></div><div class="footer-section"><h4>快速链接</h4><ul><li><a href="/#articles">文章</a></li><li><a href="/#tools">工具</a></li><li><a href="https://docs.github.com/en/pages" target="_blank">GitHub Pages</a></li></ul></div><div class="footer-section"><h4>技术栈</h4><ul><li>Python</li><li>GitHub Copilot</li><li>Claude Sonnet 4</li><li>HTML/CSS/JS</li><li>响应式设计</li></ul></div></div><div class="footer-bottom"><p>Copyright &copy; 2013-<script>document.write((new Date()).getFullYear());</script> 雪峰博客。运行在 GitHub Pages 上。 <a href="https://beian.miit.gov.cn" target="_blank" class="icp_beian">京ICP备2021007720号</a><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502052523" target="_blank" class="gongan_beian">京公网安备11010502052523号</a></p></div></div></footer><script src="/zh/index.js"></script><script src="/assets/js/blog.min.js"></script><script>hljs.highlightAll();</script></body></html>