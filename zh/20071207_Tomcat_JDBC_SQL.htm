<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>雪峰-博客</title><meta name="description" content="专注于AI、云计算、GitHub Copilot等前沿技术的分享与探讨"><meta name="keywords" content="AI, GitHub Copilot, Azure云, 云计算, 前端技术, 后端技术, Web开发, 软件工程"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script></head><body><nav class="navbar"><div class="nav-container"><div class="nav-logo"><h2><i class="fas fa-snowflake"></i> Snowpeak</h2></div><div class="nav-menu"><a href="/" class="nav-link">首页</a><a href="/#articles" class="nav-link">文章</a><a href="/#tools" class="nav-link">演示</a><a href="/about.htm" class="nav-link">关于</a><a href="/en/index.html" class="nav-link lang-switch"><i class="fas fa-globe"></i> English</a></div><div class="nav-toggle" id="mobile-menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div></div></nav><header class="article-header"><div class="container"><h1>Tomcat 6 通过 JDBC 连接池连接 SQL Server 2000 和 MySQL 5 的设置</h1><div class="article-meta"><span><i class="fas fa-calendar"></i> 发表: 2007-12-07 15:23:00</span><span><i class="fas fa-clock"></i> 阅读约需: 5分钟</span><span><i class="fas fa-tag"></i> 分类: AI技术</span></div></div></header><main class="article-container"> <pre><code>Tomcat 文档及网上看到的说明都挺乱的，我经过几天尝试现在测试成功的Tomcat 6 设置分享一下.我的环境是:
</code></pre> <p>Windows XP SP2, Windows 2003 Server SP1<br> Tomcat 6<br> SQL Server 2000<br> MySQL 5</p><h4>SQL Server 2000 连接池配置方法按顺序操作如下：</h4> <pre><code>1. 下载 SQL Server 2000 JDBC Driver 放在/Tomcat6/lib，我现在使用的是 msbase.jar、mssqlserver.jar、msutil.jar 这3个文件2. 在 Tomcat 6.0/webapps 下建立文件夹，比如 poolmssql3. poolmssql 文件夹内建 META-INF 夹，再建 context.xml 文件，内容：&lt;Context path=&quot;/poolmssql&quot; docBase=&quot;poolmssql&quot; debug=&quot;5&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;&gt;&lt;Resource name=&quot;pool_mssql&quot; auth=&quot;Container&quot; type=&quot;javax.sql.DataSource&quot;maxActive=&quot;100&quot; maxIdle=&quot;30&quot; maxWait=&quot;10000&quot;driverClassName=&quot;com.microsoft.jdbc.sqlserver.SQLServerDriver&quot;url=&quot;jdbc:microsoft:sqlserver://xx.xx.xx.xx:1433;DatabaseName=somedb&quot;username=&quot;someuser&quot; password=&quot;somepassword&quot;  /&gt;&lt;/Context&gt;
</code></pre> <pre><code>4. 在 poolmssql 文件夹下建立测试程序页，内容：&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html;charset=utf-8&quot; import=&quot;java.sql.*, javax.sql.*, javax.naming.*&quot; %&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;    &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; lang=&quot;en&quot; xml:lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&lt;title&gt;JDBC 连接池&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;%DataSource ds = null;InitialContext ctx = new InitialContext();ds = (DataSource)ctx.lookup(&quot;java:comp/env/pool_mssql&quot;);//这里 java:comp/env/ 后面的值就是context.xml 文件里 Resource 项下 name 的值 &quot;jdbc/pool_mssql&quot;Connection conn = ds.getConnection();Statement stmt = conn.createStatement();
</code></pre> <pre><code>String strSql = &quot;SELECT TOP 10 CompanyName FROM Suppliers&quot;; //找个能运行的 SQL 语句试试即可ResultSet rs = stmt.executeQuery(strSql);while(rs.next()){ out.print(rs.getString(1)+&quot;&lt;br /&gt;&quot;);}%&gt;&lt;/body&gt;&lt;/html&gt;注意：（1）在 page 声明里要 import java.sql.*, javax.sql.*, javax.naming.* 这3个包，因为这时测试程序中声明对象实例要用到的。（2）page 声明里要contentType=&quot;text/html;charset=utf-8&quot;，网页 meta 里要 content=&quot;text/html; charset=utf-8&quot;，最后程序页本身还要存成 utf-8 编码的文本文件，这是我找到的最简单的保证非西文能正常显示的方法。
</code></pre> <h4>MySQL 5 连接池配置方法与 MSSQL Server 大同小异：</h4> <pre><code>1. 下载 Connector/J 放在/Tomcat6/lib，我现在使用的是 mysql-connector-java-5.0.4-bin.jar2. 在 Tomcat 6.0/webapps 下建立文件夹，比如 mysql3. mysql 文件夹内建 META-INF 夹，再建 context.xml 文件，内容：&lt;Context path=&quot;/mymymy&quot; docBase=&quot;mymymy&quot; debug=&quot;5&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;&gt;&lt;Resource name=&quot;pool_mysql&quot; auth=&quot;Container&quot; type=&quot;javax.sql.DataSource&quot;maxActive=&quot;100&quot; maxIdle=&quot;30&quot; maxWait=&quot;10000&quot;driverClassName=&quot;com.mysql.jdbc.Driver&quot;url=&quot;jdbc:mysql://localhost:3306/dbname?autoReconnect=true&quot;username=&quot;someuser&quot; password=&quot;somepassword&quot; /&gt;&lt;/Context&gt;4. 在 mysql 文件夹下建立测试程序页，内容：&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html;charset=utf-8&quot; import=&quot;java.sql.*, javax.sql.*, javax.naming.*&quot; %&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;    &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; lang=&quot;en&quot; xml:lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&lt;title&gt;JDBC 连接池&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;%DataSource ds = null;InitialContext ctx = new InitialContext();ds = (DataSource)ctx.lookup(&quot;java:comp/env/jdbc/pool_mysql&quot;);//这里 java:comp/env/ 后面的值就是context.xml 文件里 Resource 项下 name 的值 &quot;jdbc/pool_mysql&quot;Connection conn = ds.getConnection();Statement stmt = conn.createStatement();
</code></pre> <pre><code>String strSql = &quot;SELECT TOP 10 CompanyName FROM Suppliers&quot;; //找个能运行的 SQL 语句试试即可ResultSet rs = stmt.executeQuery(strSql);while(rs.next()){ out.print(rs.getString(1)+&quot;&lt;br /&gt;&quot;);}%&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre> <p>注意：（1）在 page 声明里要 import java.sql.<em>, javax.sql.</em>, javax.naming.* 这3个包，因为这时测试程序中声明对象实例要用到的。<br> （2）以下的程序页文件本身要使用 utf-8 编码，而且 MySQL 数据库也需要先设置成 utf-8 编码的，具体方法这里不赘述，建议参见 <a href="http://unix-cd.com/vc/www/26/2007-07/6214.html">http://unix-cd.com/vc/www/26/2007-07/6214.html</a></p><h5>我这里没有做以下工作，但仍能正常运行：</h5><ul><li>设置系统的 CLASSPATH、JAVA_HOME、PATH 等参数</li><li>安装 JDK</li><li>把 aspectjrt.jar 放在 lib 下</li><li>在 mssql 文件夹内建 WEB-INF 夹，再建 web.xml 文件</li></ul><h4>常见报错：</h4> <pre><code>1. 
</code></pre> <pre><code>org.apache.tomcat.dbcp.dbcp.SQLNestedException: Cannot create PoolableConnectionFactory (Communications link failure due to underlying exception:** BEGIN NESTED EXCEPTION **java.net.SocketExceptionMESSAGE: java.net.ConnectException: Connection refused: connect
</code></pre> <p>字面意思是连接 mysql 服务被拒绝，通常是 MySQL 服务未启动造成的。</p><p>2.</p><p>java.sql.SQLException: [Microsoft][SQLServer 2000 Driver for JDBC]Error establishing socket.</p><p>SQLServer 2000 服务未启动会报这样的错。</p> <pre><code>3.
</code></pre> <pre><code>type Status reportmessage /poolmysql.jspdescription The requested resource (/xxx.jsp) is not available.
</code></pre> <p>通常是context.xml 里 url 的值写得不对 </p><p>刚入门,很多还不很理解,如有不周,欢迎交流与指正!</p></main><footer class="footer"><div class="container"><div class="footer-content"><div class="footer-section"><h3><i class="fas fa-snowflake"></i> Snowpeak</h3><p>专注于AI与云计算技术的分享平台</p><div class="social-links"><div class="social-platforms"><a href="https://github.com/xfsnow" target="_blank" class="social-link"><i class="fab fa-github"></i></a><a href="https://snowpeak.blog.csdn.net/" target="_blank" class="social-link"><i class="fas fa-blog"></i></a><a href="https://space.bilibili.com/701839928" target="_blank" class="social-link"><i class="fab fa-bilibili"></i></a><a href="https://www.linkedin.com/in/snowpeak" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a></div><div class="wechat-section"><div class="wechat-info"><span class="wechat-label">微信公众号</span><span class="wechat-name">技术温暖生活</span></div><img src="/assets/img/techwarm.jpg" alt="微信公众号二维码" class="wechat-qr"></div></div></div><div class="footer-section"><h4>快速链接</h4><ul><li><a href="#articles">最新文章</a></li><li><a href="#tools">范例演示</a></li><li><a href="https://docs.github.com/en/pages" target="_blank">GitHub Pages</a></li></ul></div><div class="footer-section"><h4>技术栈</h4><ul><li>Python</li><li>GitHub Copilot</li><li>Claude Sonnet 4</li><li>HTML/CSS/JS</li><li>响应式设计</li></ul></div></div><div class="footer-bottom"><p>Copyright &copy; 2013-<script>document.write((new Date()).getFullYear());</script> 雪峰博客。运行在 GitHub Pages 上。</p></div></div></footer><script src="/zh/index.js"></script><script src="/assets/js/blog.js"></script><script>hljs.highlightAll();</script></body></html>