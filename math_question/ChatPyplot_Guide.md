# ChatPyplot 使用说明手册

## 简介

ChatPyplot 是一个结合 Python 数据可视化库（Matplotlib）与 AI 对话功能的智能工具。用户可以通过自然语言与 AI 进行数学相关问题的交流，AI 会生成相应的 Python 代码并在浏览器中直接执行，生成对应的图表。

## 功能特点

- 支持多种 AI 模型（DeepSeek、通义千问、Azure OpenAI）
- 在浏览器中直接运行 Python 代码并生成可视化图表
- 支持图片上传与分析
- Python 代码自动生成与执行
- 对话历史记录与管理
- 内置中文字体支持，可正确显示中文标签和标题

## 系统要求

- 现代浏览器（Chrome、Firefox、Edge 等）
- 稳定的网络连接（首次加载需要下载 Pyodide 环境）
- 对应 AI 服务的 API 密钥

## 快速开始

### 1. 访问应用
打开浏览器，访问应用地址：<https://www.snowpeak.org/math_question/ChatPyplot.htm>

### 2. 配置 AI 模型
首次使用需要配置 AI 模型：

1. 点击左下角的"设置"按钮（⚙️）
2. 选择需要使用的 AI 模型：
   - DeepSeek：选择后输入 DeepSeek API 密钥
   - 通义千问：选择后输入通义千问 API 密钥
   - Azure OpenAI：选择后输入 Azure OpenAI API 密钥、访问端点和模型名称
3. 点击"保存设置"按钮

### 3. 使用 AI 对话功能
1. 在底部输入框中输入数学问题或指令
2. 按 Enter 键或点击"发送"按钮发送消息
3. AI 将分析问题并生成回答及 Python 代码
4. 用户点击“执行命令”按钮后，Python 代码会在浏览器中执行，生成相应图表
5. 用户还可以自行修改命令并执行，以获得更精确的图形

### 4. 上传图片
1. 点击输入框下方的图片图标（◪）选择图片文件
2. 支持 JPG、PNG、GIF、WEBP 格式，大小不超过 10MB
3. 预览图片后输入相关问题描述
4. 发送消息，AI 会结合图片内容进行分析

## 详细功能说明

### 对话界面
- 左侧为 AI 回复消息，右侧为用户发送消息
- AI 回复中包含 Python 代码时，会在消息下方显示"执行代码"按钮
- 点击"执行代码"按钮可在浏览器中执行所有相关代码

### 设置面板
- 可随时通过左下角"设置"按钮进入
- 支持切换不同的 AI 模型
- 各模型配置独立保存
- 系统提示语全局共享，设置一次即可应用于所有模型

### Python 图表显示区
- 自动执行生成的 Python 代码
- 显示代码生成的图表
- 执行新代码前会自动清除上一个图表

### 系统提示语
- 用于指导 AI 的行为和回答风格
- 全局设置，对所有 AI 模型生效
- 建议包含 Python 和 Matplotlib 相关指令格式说明

## Pyodide 运行环境

ChatPyplot 使用 Pyodide 技术在浏览器中运行 Python 代码。Pyodide 是一个 Python 发行版，可以在浏览器中运行，无需服务器支持。

### 工作原理
1. 首次访问时，浏览器会从 CDN 下载 Pyodide 环境（约 10-20MB）
2. 初始化完成后，Python 代码直接在浏览器中解释执行
3. Matplotlib 库用于生成图表，并转换为图像显示在页面上

### 技术优势
- 无需服务器端执行 Python 代码，保护用户隐私
- 完全在浏览器中运行，响应速度快
- 支持大部分常用的 Python 科学计算库

## 中文字体支持

为了正确显示中文标签和标题，ChatPyplot 内置了中文字体支持方案：

### 字体加载机制
1. 首次运行时，系统会自动从服务器加载中文字体文件
2. 字体文件加载后存储在浏览器的虚拟文件系统中
3. Matplotlib 配置使用该字体作为默认中文字体

### 字体使用
- 系统自动配置 Matplotlib 使用中文字体
- 无需在代码中手动设置字体
- 支持中文标签、标题和图例显示

## 使用技巧

### 1. 提问技巧
- 尽可能详细地描述数学问题或图表需求
- 明确指出需要绘制的图表类型（如折线图、柱状图、散点图等）
- 指定需要的参数或数据

### 2. 代码执行
- 每段 Python 代码独占一个文本区域
- 可编辑代码后再执行
- 点击"执行代码"按钮执行所有代码

### 3. 图片分析
- 上传包含数据图表或数学问题的图片
- 配合文字描述可以获得更准确的分析结果
- 支持各种数据图表、函数图像等数学相关内容

## 常见问题

### 1. 为什么图表没有显示中文？
- 首次使用时需要等待字体文件加载完成
- 刷新页面重新加载字体文件
- 检查浏览器控制台是否有字体加载错误

### 2. AI 回复不准确怎么办？
- 尝试更换不同的 AI 模型
- 优化问题描述，提供更多细节
- 调整系统提示语以更好地指导 AI

### 3. 图片上传失败怎么办？
- 检查图片格式是否为 JPG、PNG、GIF 或 WEBP
- 确认图片大小不超过 10MB
- 刷新页面后重新上传

## 注意事项
- 这是一个开源的纯静态的网页程序，您的 API 密钥保存在本地浏览器，只和目标AI服务平台通信，不会中转或存储。当然仍然建议你保管好自己的API密钥，不要泄露给他人。
- 对话历史仅保存在当前浏览器会话中，关闭页面后将丢失。
- 使用图片功能时请确保内容与数学相关，以获得最佳分析效果。
- 不同 AI 模型的能力和特点可能有所差异，可根据需求选择。
- 首次加载时需要下载 Pyodide 环境，可能需要一些时间，请耐心等待。