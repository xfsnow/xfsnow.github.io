<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Snowpeak Blog</title><meta name="description" content="Sharing and discussing cutting-edge technologies of AI and cloud computing, and other interesting topics."><meta name="keywords" content="AI, GitHub Copilot, Azure Cloud, Cloud Computing, Front-end Technology, Back-end Technology, Web Development, Software Engineering"><link rel="stylesheet" href="/assets/css/style.min.css"><link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script></head><body><nav class="navbar"><div class="nav-container"><div class="nav-logo"><h2><i class="fas fa-snowflake"></i> Snowpeak</h2></div><div class="nav-menu"><a href="/en/" class="nav-link">Home</a><a href="/en/page_1.htm" class="nav-link">Article</a><a href="/en#tools" class="nav-link">Tools</a><a href="/en/about.htm" class="nav-link">About</a><a href="/" class="nav-link lang-switch"><i class="fas fa-globe"></i> 简体中文</a></div><div class="nav-toggle" id="mobile-menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div></div></nav><header class="article-header"><div class="container"><h1>Dynamically including ASP File Improved</h1><div class="article-meta"><span><i class="fas fa-calendar"></i> Published: 2006-11-23 16:33:00</span><span><i class="fas fa-clock"></i> Reading time: 11 minutes </span><span><i class="fas fa-tag"></i> Category: Backend</span></div></div></header><main class="article-container"><h2><a href="/en/article/detail/dynamically_including_asp_file_improved/">Dynamically including ASP File Improved</a></h2><hr><p><em>Link: https://www.snowpeak.fun/en/article/detail/dynamically_including_asp_file_improved/</em></p><h2>Dynamically Including ASP Files: Enhancements</h2><p>ASP itself does not support dynamic file inclusion. Current dynamic inclusion is achieved by merging the included file into the main file using FSO before execution. Below, the traditional inclusion method (e.g., <code>&lt;--#include file="filename.asp"&gt;</code>) is referred to as "traditional reference," while dynamic file inclusion implemented via functions is referred to as "dynamic reference."</p><p>A common implementation is as follows:</p> <pre><code class="language-asp">Function include(filename)
    Dim re, content, fso, f, aspStart, aspEnd
    set fso = CreateObject(&quot;Scripting.FileSystemObject&quot;)
    set f = fso.OpenTextFile(server.mappath(filename))
    content = f.ReadAll
    f.close
    set f = nothing
    set fso = nothing
    set re = new RegExp
    re.pattern = &quot;^/s*=&quot;
    aspEnd = 1
    aspStart = inStr(aspEnd, content, &quot;&lt;%&quot;) + 2
    do while aspStart &gt; aspEnd + 1
        Response.write Mid(content, aspEnd, aspStart - aspEnd - 2)
        aspEnd = inStr(aspStart, content, &quot;%&gt;&quot;) + 2
        Execute(re.replace(Mid(content, aspStart, aspEnd - aspStart - 2), &quot;Response.Write &quot;))
        aspStart = inStr(aspEnd, content, &quot;&lt;%&quot;) + 2
    loop
    Response.write Mid(content, aspEnd)
    set re = nothing
End Function
</code></pre> <p>Usage example: <code>include("youinc.asp")</code></p><p>The above example is cited from <a href="http://www.blueidea.com/tech/program/2003/101.asp">http://www.blueidea.com/tech/program/2003/101.asp</a>.</p><p>However, this function fails when the included file itself contains other included files. Based on the above function, I have developed the following improved function, which can handle cases where the included file contains traditional inclusion files.</p> <pre><code class="language-asp">Function includeconvert(oRegExp, strFilename, strBlock)
    Dim incStart, incEnd, match, oMatches, str, code
    'Extract the filename from the include section using the same method as extracting ASP code, and output the rest as is.
    code = &quot;&quot;
    incEnd = 1
    incStart = InStr(incEnd, strBlock, &quot;&lt;--#&quot;) + 3
    oRegExp.pattern = &quot;(\w+)=&quot;&quot;([^&quot;&quot;]+)&quot;&quot;&quot; 'Matches file=&quot;filename.ext&quot; or virtual=&quot;virtualname.ext&quot;, capturing type and filename as two substrings.
    Set oMatches = oRegExp.Execute(Mid(strBlock, incStart, incEnd - incStart - 3))
    Set match = oMatches(0) 'When there is only one match, this retrieves it, avoiding the need for For Each match In oMatches ... Next.
    code = code &amp; include(Mid(strFilename, 1, InStrRev(strFilename, &quot;/&quot;)) &amp; match.SubMatches(1))
    'Mid(filename, 1, InStrRev(filename, &quot;/&quot;)) extracts the path from the referenced subfile name if it has a path, appending it to the traditionally referenced filename in the subfile to find the correct file path. This is because the file path for dynamic references is relative to the main file.
    'To get the second captured substring, use SubMatches(1).
    incStart = InStr(incEnd, strBlock, &quot;&lt;!--#include &quot;) + 13
    Loop
    str = Mid(strBlock, incEnd)
    str = Replace(str, &quot;&quot;&quot;&quot;, &quot;&quot;&quot;&quot;&quot;) 'Replace single double quotes with two double quotes.
    str = Replace(str, VbCr, &quot;&quot;)
    str = Replace(str, VbLf, &quot;&quot;)
    str = Replace(str, VbCrLf, &quot;&quot;)
    code = code &amp; VbCrLf &amp; &quot;Response.Write &quot;&quot;&quot; &amp; str &amp; &quot;&quot;&quot;&quot;
    includeconvert = code
End Function

Function include(filename)
    Dim re, content, fso, f, aspStart, aspEnd, code
    Set fso = CreateObject(&quot;scripting.FileSystemObject&quot;)
    Set f = fso.OpenTextFile(Server.MapPath(filename))
    content = f.ReadAll
    f.close
    Set f = nothing
    Set fso = nothing

    code = &quot;&quot;
    aspEnd = 1
    aspStart = InStr(aspEnd, content, &quot;&lt;%&quot;) + 2
    Set re = new RegExp
    Do While aspStart &gt; aspEnd + 1
        'Traditional references &lt;!--#include are definitely outside ASP code blocks, so convert them first.
        code = code &amp; includeconvert(re, filename, Mid(content, aspEnd, aspStart - aspEnd - 2))
        aspEnd = InStr(aspStart, content, &quot;%&gt;&quot;) + 2
        re.pattern = &quot;^/s*=&quot; 'This regex replaces &lt;% = str %&gt; with the standard &lt;%Response.Write str %&gt;.
        'Add a newline before ASP blocks to avoid errors caused by multiple Response.Write statements on the same line.
        code = code &amp; VbCrLf &amp; re.replace(Mid(content, aspStart, aspEnd - aspStart - 2), &quot;Response.Write &quot;)
        aspStart = InStr(aspEnd, content, &quot;&lt;%&quot;) + 2
    Loop
    code = code &amp; includeconvert(re, filename, Mid(content, aspEnd))
    Set re = nothing
    include = code
End Function
</code></pre> <p>For convenience, the above function ultimately returns the entire ASP code with the included files integrated. To use it, you need to execute it with <code>Execute(include("file.asp"))</code>.</p><p>The above function has been tested successfully when the included file and the main file are in the same path. Further error handling for cases where the included file and the main file are in different paths has not been implemented due to time constraints. Feedback and improvements are welcome.</p><hr><p><em>Original link: https://www.snowpeak.fun/cn/article/detail/dynamically_including_asp_file_improved/</em></p></main><footer class="footer"><div class="container"><div class="footer-content"><div class="footer-section"><h3><i class="fas fa-snowflake"></i> Snowpeak</h3><p>Sharing and discussing cutting-edge technologies of AI and cloud computing, and other interesting topics.</p><div class="social-links"><div class="social-platforms"><a href="https://github.com/xfsnow" target="_blank" class="social-link"><i class="fab fa-github"></i></a><a href="https://snowpeak.blog.csdn.net/" target="_blank" class="social-link"><i class="fas fa-blog"></i></a><a href="https://space.bilibili.com/701839928" target="_blank" class="social-link"><i class="fab fa-bilibili"></i></a><a href="https://www.linkedin.com/in/snowpeak" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a></div><div class="wechat-section"><div class="wechat-info"><span class="wechat-label">WeChat Account</span><span class="wechat-name">Tech Warm Life</span></div><img src="/assets/img/techwarm.jpg" alt="Tech Warm Life" class="wechat-qr"></div></div></div><div class="footer-section"><h4>Quick Links</h4><ul><li><a href="/#articles">Article</a></li><li><a href="/#tools">Tools</a></li><li><a href="https://docs.github.com/en/pages" target="_blank">GitHub Pages</a></li></ul></div><div class="footer-section"><h4>Tech Stack</h4><ul><li>Python</li><li>GitHub Copilot</li><li>Claude Sonnet 4</li><li>HTML/CSS/JS</li><li>Responsive Design</li></ul></div></div><div class="footer-bottom"><p>Copyright &copy; 2013-<script>document.write((new Date()).getFullYear());</script> Snowpeak Blog. Running on GitHub Pages. <a href="https://beian.miit.gov.cn" target="_blank" class="icp_beian">京ICP备2021007720号</a><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502052523" target="_blank" class="gongan_beian">京公网安备11010502052523号</a></p></div></div></footer><script src="/en/index.js"></script><script src="/assets/js/blog.min.js"></script><script>hljs.highlightAll();</script></body></html>