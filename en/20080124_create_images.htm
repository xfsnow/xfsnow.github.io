<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Snowpeak Blog</title><meta name="description" content="Sharing and discussing cutting-edge technologies of AI and cloud computing, and other interesting topics."><meta name="keywords" content="AI, GitHub Copilot, Azure Cloud, Cloud Computing, Front-end Technology, Back-end Technology, Web Development, Software Engineering"><link rel="stylesheet" href="/assets/css/style.min.css"><link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script></head><body><nav class="navbar"><div class="nav-container"><div class="nav-logo"><h2><i class="fas fa-snowflake"></i> Snowpeak</h2></div><div class="nav-menu"><a href="/en/" class="nav-link">Home</a><a href="/en/page_1.htm" class="nav-link">Article</a><a href="/en#tools" class="nav-link">Tools</a><a href="/en/about.htm" class="nav-link">About</a><a href="/" class="nav-link lang-switch"><i class="fas fa-globe"></i> 简体中文</a></div><div class="nav-toggle" id="mobile-menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div></div></nav><header class="article-header"><div class="container"><h1>Create Images with JSP Reading Image data in SQL Server 2000</h1><div class="article-meta"><span><i class="fas fa-calendar"></i> Published: 2008-01-24 20:03:00</span><span><i class="fas fa-clock"></i> Reading time: 6 minutes </span><span><i class="fas fa-tag"></i> Category: Development</span></div></div></header><main class="article-container"><h2><a href="/en/article/detail/create_images_with_jsp_reading_image_data_in_sql_server_2000/">Create Images with JSP Reading Image data in SQL Server 2000</a></h2><h3>Environment</h3><p>Windows XP Tomcat 6.0 jre1.6.0_03 SQL Server 2000</p><h3>Task</h3><p>In the database table, user_id is the user ID, and the photo field stores the binary data of the photo. The following code can read all users' photo binary data, write it as image files, and use the user ID as the file name.</p><h3>Code</h3> <pre><code class="language-jsp">&lt;%@ page language=&quot;java&quot; import=&quot;java.sql.*, java.io.*&quot; %&gt;
&lt;%
// Connect to DB
Class.forName(&quot;com.microsoft.jdbc.sqlserver.SQLServerDriver&quot;).newInstance();
String url = &quot;jdbc:microsoft:sqlserver://dbserver:1433;DatabaseName=dbname&quot;;
String user = &quot;user&quot;;
String password = &quot;password&quot;;
Connection conn = DriverManager.getConnection(url, user, password);
Statement stmt = conn.createStatement();
ResultSet rs;

String strSql = &quot;select user_id, photo FROM tablename&quot;;

InputStream in = null;
FileOutputStream fileOutStream = null;
rs = stmt.executeQuery(strSql);

while(rs.next()) {
    // On Windows systems, use double backslashes for storage paths
    DataOutputStream sos = new DataOutputStream(
        new BufferedOutputStream(
            new FileOutputStream(&quot;X://filesavepath//&quot; + rs.getString(&quot;user_id&quot;) + &quot;.jpg&quot;)
        )
    );

    // Use the getBinaryStream() method to read the stream
    in = rs.getBinaryStream(&quot;photo&quot;);

    // Gradually output the stream using a buffer array
    int len = 0;
    byte[] b = new byte[1024];
    while ((len = in.read(b)) != -1) {
        sos.write(b, 0, len);
    }

    sos.close();
    in.close();
}

rs.close();
conn.close();
%&gt;
</code></pre> <h3>Secret</h3><p>SQL query used here is</p> <pre><code class="language-sql">select user_id, photo FROM tablename;
</code></pre> <p>Note the order of field names. If there are more fields to retrieve, the binary data field name "photo" must be placed last! When using the JDBC database driver for SQL Server 2000, when getXXX returns field values, they must be returned in the order the field names appear in the SQL query statement, which is well known. But the tricky part is that if the photo field is not placed last, you have to first use getBinaryStream("photo") to return the binary data, and then when returning other type field values, you will encounter a strange error:</p> <pre><code class="language-java">java.io.IOException: [Microsoft][SQLServer 2000 Driver for JDBC]Object has been closed.
</code></pre> <p>I spent a lot of time figuring out that as long as the field name photo is placed last, it will work, but it won't work if it's not placed last. According to online research, the reason is said to be a problem with the JDBC database driver for SQL Server 2000.</p><p>I hope this can help others. Friends who understand this matter are welcome to discuss it together.</p><hr><p><em>Original link: https://www.snowpeak.fun/en/article/detail/create_images_with_jsp_reading_image_data_in_sql_server_2000/</em></p></main><footer class="footer"><div class="container"><div class="footer-content"><div class="footer-section"><h3><i class="fas fa-snowflake"></i> Snowpeak</h3><p>Sharing and discussing cutting-edge technologies of AI and cloud computing, and other interesting topics.</p><div class="social-links"><div class="social-platforms"><a href="https://github.com/xfsnow" target="_blank" class="social-link"><i class="fab fa-github"></i></a><a href="https://snowpeak.blog.csdn.net/" target="_blank" class="social-link"><i class="fas fa-blog"></i></a><a href="https://space.bilibili.com/701839928" target="_blank" class="social-link"><i class="fab fa-bilibili"></i></a><a href="https://www.linkedin.com/in/snowpeak" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a></div><div class="wechat-section"><div class="wechat-info"><span class="wechat-label">WeChat Account</span><span class="wechat-name">Tech Warm Life</span></div><img src="/assets/img/techwarm.jpg" alt="Tech Warm Life" class="wechat-qr"></div></div></div><div class="footer-section"><h4>Quick Links</h4><ul><li><a href="/#articles">Article</a></li><li><a href="/#tools">Tools</a></li><li><a href="https://docs.github.com/en/pages" target="_blank">GitHub Pages</a></li></ul></div><div class="footer-section"><h4>Tech Stack</h4><ul><li>Python</li><li>GitHub Copilot</li><li>Claude Sonnet 4</li><li>HTML/CSS/JS</li><li>Responsive Design</li></ul></div></div><div class="footer-bottom"><p>Copyright &copy; 2013-<script>document.write((new Date()).getFullYear());</script> Snowpeak Blog. Running on GitHub Pages. <a href="https://beian.miit.gov.cn" target="_blank" class="icp_beian">京ICP备2021007720号</a><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502052523" target="_blank" class="gongan_beian">京公网安备11010502052523号</a></p></div></div></footer><script src="/en/index.js"></script><script src="/assets/js/blog.min.js"></script><script>hljs.highlightAll();</script></body></html>