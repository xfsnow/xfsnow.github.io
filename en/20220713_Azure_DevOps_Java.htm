<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Snowpeak Blog</title><meta name="description" content="Sharing and discussing cutting-edge technologies of AI and cloud computing, and other interesting topics."><meta name="keywords" content="AI, GitHub Copilot, Azure Cloud, Cloud Computing, Front-end Technology, Back-end Technology, Web Development, Software Engineering"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script></head><body><nav class="navbar"><div class="nav-container"><div class="nav-logo"><h2><i class="fas fa-snowflake"></i> Snowpeak</h2></div><div class="nav-menu"><a href="/en/" class="nav-link">Home</a><a href="/en/page_1.htm" class="nav-link">Article</a><a href="/en#tools" class="nav-link">Tools</a><a href="/en/about.htm" class="nav-link">About</a><a href="/" class="nav-link lang-switch"><i class="fas fa-globe"></i> 简体中文</a></div><div class="nav-toggle" id="mobile-menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div></div></nav><header class="article-header"><div class="container"><h1>Azure DevOps Deploying Java Spring Applications to Azure App Service</h1><div class="article-meta"><span><i class="fas fa-calendar"></i> Published: 2022-07-13 10:57:47</span><span><i class="fas fa-clock"></i> Reading time: 22 minutes </span><span><i class="fas fa-tag"></i> Category: Azure</span></div></div></header><main class="article-container"><p>Azure DevOps is an end-to-end enterprise-level development management platform on Microsoft Azure cloud platform, where Azure Pipelines is the core service for implementing CI/CD using pipelines. Azure App Service is a fully managed platform-as-a-service (PaaS) product for developers that can quickly build HTTP-based web applications, APIs, and mobile backends. Spring Boot is the most mainstream development framework for current Java applications. This article uses a basic example to explain in detail how to use Azure Pipelines to create and edit pipelines, building and deploying Java Spring applications to Azure App Service.</p><h2>Java Spring Demo Code</h2><p>The source code is here <a href="https://github.com/xfsnow/SpringTomcat" title="GitHub - xfsnow/SpringTomcat: A demo project of Spring Boot running in Tomcat deployed to Azure App Service with Azure DevOps.">GitHub - xfsnow/SpringTomcat: A demo project of Spring Boot running in Tomcat deployed to Azure App Service with Azure DevOps.</a>. Please fork it to your own GitHub for practice. Alternatively, you can use this as a reference and directly create a default Maven Project using Spring Initializr in Visual Studio Code. Note that the packaging mode should be set to war package because we want to use an external Tomcat Server rather than the built-in Tomcat Server in Spring Boot. Pay attention to the following configuration items in pom.xml:</p> <pre><code class="language-xml">&lt;properties&gt;
    &lt;java.version&gt;11&lt;/java.version&gt;
&lt;/properties&gt;
</code></pre> <p>Reference Tomcat Server-related libraries to facilitate the use of javax.servlet packages.</p> <pre><code class="language-xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
      &lt;artifactId&gt;tomcat-servlet-api&lt;/artifactId&gt;
      &lt;version&gt;10.0.8&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
      &lt;artifactId&gt;tomcat-jsp-api&lt;/artifactId&gt;
      &lt;version&gt;10.0.8&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre> <h2>Creating Azure App Service Instance</h2><p>Log in to the Azure console https://portal.azure.com/, find the App Service service, and click Create in the upper left corner to create an App Service instance. In the creation wizard, the key items on the Basics page are the configurations in the Instance Details section.</p><p>Publish: select Code;</p><p>Runtime Stack: select Java 11;</p><p>Java web server stack: select Apache Tomcat 9.0;</p><p>Operating System: select Linux;</p><p>Region: select a mainstream region, in this example, East Asia is selected.</p><p>App Service Plan: select the free tier Free F1 level, which can take full advantage of Azure's free opportunities without incurring resource costs.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_01.png"></p><p>Note that the Java 11 and Tomcat 9.0 selected here are compatible with the Java and Tomcat versions configured in the demo code. The demo code chooses these versions based on the dependencies required by the current Spring Boot version 5.3.21. The built-in Maven in Azure DevOps Pipeline requires Java 11 version to build. This ultimately achieves consistent runtime versions across development, CI, and deployment environments, ensuring normal operation when deployed to App Service later. Otherwise, dependency errors and 404 errors will occur.</p><p>Keep the default settings on other wizard pages and click the "Create" button to create.</p><p>Wait a few minutes for the instance resource to be created. Go to the Overview page of this App Service instance and click the URL on the right, such as https://contoso.azurewebsites.net, which will open the application in a new window. Java applications need to wait a few minutes to run for the first time. Once you can see a default homepage similar to the following, it indicates that this App Service has been successfully created.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_02.png"></p><p>Next, we will use Azure DevOps Pipeline to deploy the demo application mentioned earlier to replace this default homepage.</p><h2>Configuring Azure Pipeline to Build and Deploy Java Application</h2><h3>Jumping from Azure Console to Azure DevOps Dedicated Console Pipelines</h3><p>Enter DevOps in the search bar at the top of the Azure console, then click DevOps Organizations.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_03.png"></p><p>This will take you to a transition page that jumps to the DevOps dedicated console.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_04.png"></p><p>Click the "My Azure DevOps Organizations" link again. Proceed to the DevOps organization selection page.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_05.png"></p><p>I have only one organization here. Click the organization link to finally reach the Azure DevOps dedicated console.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_06.png"></p><p>Click the first project square to enter the project console. Finally, click the blue rocket icon in the left navigation links to reach the pipeline management interface.</p><h3>Creating Azure Pipeline</h3><p>On the Azure Pipelines main interface, click the "New pipeline" button in the upper right corner to create a new pipeline. According to the pipeline creation wizard, select GitHub in "Where is your code".</p><p>If this is your first time connecting to GitHub, it will redirect to GitHub login and authorization pages. Follow the prompts to operate.</p><p>Then go to "Select a repository" and choose the source code repository you forked earlier.</p><p>On the Configure page, select "Maven package Java project Web App to Linux on Azure".</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_07.png"></p><p>A popup will appear. Follow the prompts to select the Azure subscription, resource group, and the App Service resource created earlier.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_08.png"></p><p>On the next page, select the previously created App Service instance from the Web App name dropdown menu.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_09.png"></p><p>Newly created instances in App Service may not display in the dropdown menu. Please wait patiently until they can be displayed. After selecting the corresponding instance name, click the "Validate and configure" button in the lower right corner. Wait a few seconds, then you'll be redirected to the Review page.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_10.png"></p><p>It's recommended to click the filename and rename it to something meaningful, such as pipelines-Build-Deploy-AppService.yml.</p><p>Click the "Save and run" button in the upper right corner. In the popup prompt, it's recommended to write a meaningful message in the Commit message, as this pipeline file will be committed to the same source code repository by default. Finally, click the "Save and run" button in the lower right corner of the popup, which will redirect to the pipeline execution interface.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_11.png"></p><p>Click Build Stage to proceed to the log interface of the ongoing task.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_12.png"></p><p>After the build execution is completed, the Deploy stage requires authorization confirmation when deploying to Azure App Service for the first time.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_13.png"></p><p>Click the "View" button. In the "Waiting for review" popup, click "Permit" to authorize, then click "Permit" again in the popup to confirm.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_14.png"></p><p>After authorization, the Deploy stage will continue executing until successful completion. Then we can see in the Summary of the pipeline execution page that Related shows "1 published".</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_15.png"></p><p>Click this link and expand step by step to see that the built artifact is named spring-0.0.1-SNAPSHOT.war.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_16.png"></p><h2>Checking Azure App Service Deployment Status</h2><p>Return to the Azure console https://portal.azure.com/, find the App Service instance, and click Deployment Center under Deployment in the left navigation. You can see the successful deployment record displayed as follows.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_17.png"></p><p>Go back to the Overview page and click the public service URL on the right. You'll find that the website homepage shows a 404 error.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_18.png"></p><p>Because our project's pom.xml declares that the artifact filename is spring-0.0.1-SNAPSHOT.war, which is also what we saw in the pipeline completion results, when deployed to Tomcat Server by default, it adds a subpath /spring-0.0.1-SNAPSHOT. We can access it by adding /spring-0.0.1-SNAPSHOT after the App Service URL mentioned above.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_19.png"></p><h2>Configuring to App Service Site Root Directory</h2><p>To deploy to the website root directory in Tomcat Server, there's a simple method: specify the war package name as ROOT.war. We can add a rename step in the Pipelines pipeline. In the Pipeline list, click the pipeline we created, then click the "Edit" button in the upper right corner to edit it.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_20.png"></p><p>In the editing interface, find the line <code>- task: CopyFiles@2</code> and add the following above this line:</p> <pre><code class="language-yaml"># Add a rename step to unify the packaged artifact filename to ROOT.war for subsequent deployment to the App Service root directory.
- bash: |
  echo $(System.DefaultWorkingDirectory)
  mv $(System.DefaultWorkingDirectory)/target/*.war $(System.DefaultWorkingDirectory)/target/ROOT.war
</code></pre> <p>This task actually uses the bash command execution task type in Pipeline. $(System.DefaultWorkingDirectory) is an environment variable in Pipeline. The previous build task will build hello.war according to the output settings specified in our pom.xml. We use the mv command to rename it to ROOT.war. After saving the pipeline, it will execute automatically. Wait for execution to complete. Go to the App Service public service URL again and refresh. The application should now be accessible from the domain root directory.</p><p><img alt="" src="../assets/img/20220713_Azure_DevOps_Java_21.png"></p></main><footer class="footer"><div class="container"><div class="footer-content"><div class="footer-section"><h3><i class="fas fa-snowflake"></i> Snowpeak</h3><p>Sharing and discussing cutting-edge technologies of AI and cloud computing, and other interesting topics.</p><div class="social-links"><div class="social-platforms"><a href="https://github.com/xfsnow" target="_blank" class="social-link"><i class="fab fa-github"></i></a><a href="https://snowpeak.blog.csdn.net/" target="_blank" class="social-link"><i class="fas fa-blog"></i></a><a href="https://space.bilibili.com/701839928" target="_blank" class="social-link"><i class="fab fa-bilibili"></i></a><a href="https://www.linkedin.com/in/snowpeak" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a></div><div class="wechat-section"><div class="wechat-info"><span class="wechat-label">WeChat Account</span><span class="wechat-name">Tech Warm Life</span></div><img src="/assets/img/techwarm.jpg" alt="Tech Warm Life" class="wechat-qr"></div></div></div><div class="footer-section"><h4>Quick Links</h4><ul><li><a href="/#articles">Article</a></li><li><a href="/#tools">Tools</a></li><li><a href="https://docs.github.com/en/pages" target="_blank">GitHub Pages</a></li></ul></div><div class="footer-section"><h4>Tech Stack</h4><ul><li>Python</li><li>GitHub Copilot</li><li>Claude Sonnet 4</li><li>HTML/CSS/JS</li><li>Responsive Design</li></ul></div></div><div class="footer-bottom"><p>Copyright &copy; 2013-<script>document.write((new Date()).getFullYear());</script> Snowpeak Blog. Running on GitHub Pages.</p></div></div></footer><script src="/en/index.js"></script><script src="/assets/js/blog.js"></script><script>hljs.highlightAll();</script></body></html>