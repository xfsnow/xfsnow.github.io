<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Snowpeak Blog</title><meta name="description" content="Sharing and discussing cutting-edge technologies of AI and cloud computing, and other interesting topics."><meta name="keywords" content="AI, GitHub Copilot, Azure Cloud, Cloud Computing, Front-end Technology, Back-end Technology, Web Development, Software Engineering"><link rel="stylesheet" href="/assets/css/style.min.css"><link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script></head><body><nav class="navbar"><div class="nav-container"><div class="nav-logo"><h2><i class="fas fa-snowflake"></i> Snowpeak</h2></div><div class="nav-menu"><a href="/en/" class="nav-link">Home</a><a href="/en/page_1.htm" class="nav-link">Article</a><a href="/en#tools" class="nav-link">Tools</a><a href="/en/about.htm" class="nav-link">About</a><a href="/" class="nav-link lang-switch"><i class="fas fa-globe"></i> 简体中文</a></div><div class="nav-toggle" id="mobile-menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div></div></nav><header class="article-header"><div class="container"><h1>Displaying Code Coverage in Azure Pipeline</h1><div class="article-meta"><span><i class="fas fa-calendar"></i> Published: 2023-01-23 10:00:00</span><span><i class="fas fa-clock"></i> Reading time: 12 minutes </span><span><i class="fas fa-tag"></i> Category: Azure</span></div></div></header><main class="article-container"><p>Azure Pipeline is a managed service in Microsoft's cloud-based DevOps toolset responsible for automated pipelines. It has comprehensive pipeline management capabilities and integrates easily with various testing, building, and deployment tools. Code coverage is an important metric in automated testing that measures the proportion of source code executed during testing compared to the total source code, indirectly measuring software quality. If a project's code is configured to export code coverage, Azure Pipeline can collect and store the corresponding data. However, by default, this data is only available for download and requires other tools for viewing. This article briefly introduces how to visually display code coverage in the Azure Pipeline console.</p><h2>Preparing the Project Source Code</h2><p>We initialize a standard .NET test project using <code>dotnet new xunit</code>. In VS Code, it looks like this:</p><p><img alt="Text Description automatically generated" src="../assets/img/20230123_Azure_DevOps_Coverage_01.png"></p><p>To implement code coverage, the core configuration is in the NetCodeCoverage.csproj file in the following section:</p> <pre><code class="language-xml">&lt;PackageReference Include=&quot;coverlet.collector&quot; Version=&quot;3.1.2&quot;&gt;
      &lt;IncludeAssets&gt;runtime; build; native; contentfiles; analyzers; buildtransitive&lt;/IncludeAssets&gt;
      &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;
&lt;/PackageReference&gt;
</code></pre> <p>If it's not there, you can add it manually.</p><p>Then execute the <code>dotnet build</code> and <code>dotnet test</code> commands to see the following output:</p><p><img alt="A screenshot of a computer Description automatically generated" src="../assets/img/20230123_Azure_DevOps_Coverage_02.png"></p><p>The default created tests have no code logic, so they naturally pass. If there are issues, you can fork the source code directly from my GitHub.</p><p><a href="https://github.com/xfsnow/NetCodeCoverage">https://github.com/xfsnow/NetCodeCoverage</a></p><h2>Creating an Azure Pipeline</h2><p>In the Azure DevOps console, find Pipeline under Pipelines and create a new YAML format pipeline by clicking New pipeline in the upper right corner.</p><p>For "Where is your code", select GitHub first. Connect to the GitHub repository you just committed.</p><p>On the Configure page, select Starter template. Finally, on the Review page, we see the following initial pipeline appearance:</p><p><img alt="Graphical user interface, text, application, email Description automatically generated" src="../assets/img/20230123_Azure_DevOps_Coverage_03.png"></p><p>Delete the existing 2 script tasks. Click Show assistant in the upper right corner, then click .NET Core in Tasks, as shown in the figure below, to first add a build task:</p><p><img alt="Graphical user interface, text, application Description automatically generated" src="../assets/img/20230123_Azure_DevOps_Coverage_04.png"></p><p>Then select test from the Command menu:</p><p><img alt="Graphical user interface, text, application Description automatically generated" src="../assets/img/20230123_Azure_DevOps_Coverage_05.png"></p><p>Note to keep "Publish test results and code coverage" checked, then add a test task.</p><p>Finally, add a publish code coverage task.</p><p>Finally, click the Save and run button in the upper right corner, and commit to the repository and execute as prompted.</p><h2>Viewing Code Coverage Reports</h2><p>After the pipeline execution is complete, we can view the code coverage report in the Azure Pipeline interface.</p><p>On the pipeline run details page, find the Tests tab and click to enter:</p><p><img alt="Graphical user interface, application Description automatically generated" src="../assets/img/20230123_Azure_DevOps_Coverage_06.png"></p><p>In the Tests tab, you can see the summary of test results, including the number of passed tests, failed tests, etc. Scroll down to see the Code Coverage section:</p><p><img alt="Graphical user interface, text, application, email Description automatically generated" src="../assets/img/20230123_Azure_DevOps_Coverage_07.png"></p><p>Click on the Code Coverage area to expand detailed information, including line coverage, branch coverage, and other metrics.</p><h2>Configuring Code Coverage Thresholds</h2><p>To ensure code quality, we can set code coverage thresholds in the pipeline. If the actual coverage is below the set threshold, the pipeline will fail.</p><p>In the Azure Pipeline YAML file, we can add the following configuration:</p> <pre><code class="language-yaml">- task: DotNetCoreCLI@2
  displayName: 'dotnet test'
  inputs:
    command: test
    projects: '**/*.csproj'
    arguments: '--configuration $(BuildConfiguration) --collect:&quot;XPlat Code Coverage&quot; -- DataCollectionRunSettings.DataCollectors.DataCollector.Configuration.Format=cobertura'
    publishTestResults: true
    failTaskOnFailedTests: true

- task: PublishCodeCoverageResults@1
  displayName: 'Publish code coverage'
  inputs:
    codeCoverageTool: Cobertura
    summaryFileLocation: '$(Agent.TempDirectory)/**/coverage.cobertura.xml'
    failIfCoverageEmpty: true
</code></pre> <h2>Using SonarCloud for Further Analysis</h2><p>In addition to Azure Pipeline's built-in code coverage functionality, we can also integrate SonarCloud to obtain more detailed code quality analysis.</p><p>First, create a project on SonarCloud, then add SonarCloud analysis tasks in Azure Pipeline:</p> <pre><code class="language-yaml">- task: SonarCloudPrepare@1
  inputs:
    SonarCloud: 'SonarCloudConnection'
    organization: 'your-organization'
    scannerMode: 'MSBuild'
    projectKey: 'your-project-key'
    projectName: 'Your Project Name'

- task: SonarCloudAnalyze@1

- task: SonarCloudPublish@1
  inputs:
    pollingTimeoutSec: '300'
</code></pre> <p>This way, you can view more detailed code quality reports in SonarCloud, including code coverage, duplicate code, code smells, and other metrics.</p><h2>Summary</h2><p>Through this article, we learned how to configure and display code coverage reports in Azure Pipeline. Code coverage is an important metric for measuring software testing quality. By integrating code coverage checks into the CI/CD pipeline, teams can continuously improve code quality.</p><p>The main steps include: 1. Configuring the coverlet.collector package in the project 2. Configuring test and code coverage publishing tasks in Azure Pipeline 3. Viewing code coverage reports in pipeline results 4. Optionally configuring coverage thresholds and integrating SonarCloud for deeper analysis</p><p>Through these practices, teams can better monitor and improve code quality, ensuring the reliability of software delivery.</p></main><footer class="footer"><div class="container"><div class="footer-content"><div class="footer-section"><h3><i class="fas fa-snowflake"></i> Snowpeak</h3><p>Sharing and discussing cutting-edge technologies of AI and cloud computing, and other interesting topics.</p><div class="social-links"><div class="social-platforms"><a href="https://github.com/xfsnow" target="_blank" class="social-link"><i class="fab fa-github"></i></a><a href="https://snowpeak.blog.csdn.net/" target="_blank" class="social-link"><i class="fas fa-blog"></i></a><a href="https://space.bilibili.com/701839928" target="_blank" class="social-link"><i class="fab fa-bilibili"></i></a><a href="https://www.linkedin.com/in/snowpeak" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a></div><div class="wechat-section"><div class="wechat-info"><span class="wechat-label">WeChat Account</span><span class="wechat-name">Tech Warm Life</span></div><img src="/assets/img/techwarm.jpg" alt="Tech Warm Life" class="wechat-qr"></div></div></div><div class="footer-section"><h4>Quick Links</h4><ul><li><a href="/#articles">Article</a></li><li><a href="/#tools">Tools</a></li><li><a href="https://docs.github.com/en/pages" target="_blank">GitHub Pages</a></li></ul></div><div class="footer-section"><h4>Tech Stack</h4><ul><li>Python</li><li>GitHub Copilot</li><li>Claude Sonnet 4</li><li>HTML/CSS/JS</li><li>Responsive Design</li></ul></div></div><div class="footer-bottom"><p>Copyright &copy; 2013-<script>document.write((new Date()).getFullYear());</script> Snowpeak Blog. Running on GitHub Pages. <a href="https://beian.miit.gov.cn" target="_blank" class="icp_beian">京ICP备2021007720号</a><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502052523" target="_blank" class="gongan_beian">京公网安备11010502052523号</a></p></div></div></footer><script src="/en/index.js"></script><script src="/assets/js/blog.min.js"></script><script>hljs.highlightAll();</script></body></html>